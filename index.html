<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta charset="utf-8"><title>头像+圣诞帽工具</title><style>        html,body,p,label,input,canvas{            margin: 0;            padding: 0;        }a{display:none}        html{            font-size: 10px;            height: 100%;            min-height: 100%;        }        body{            background:-webkit-gradient(linear, 0 0, 0 100%, from(#FFF9D4), to(#F9B9B9));            font-size: 1.4rem;            background-color: #F9B9B9;        }        canvas{            background: #fff;        }        .mod-canvas{            display: none;            width: 36rem;            height: 50rem;        }        .mod-start{            position: relative;        }        .mod-start img{            position: absolute;            top: 10rem;            left: 2.75rem;            width: 30.5rem;            height: 26.9rem;        }        .mod-main-button{            position: absolute;            top: 48rem;            left: 8.5rem;        }        .mod-start .btn{            position: absolute;            top: 43rem;            left: 8.5rem;        }        .mod-main-button label, .mod-start .btn{            display: block;            margin: 0 auto;            text-align: center;            font-size: 3rem;            color: #FFFFFF;            width: 20rem;            line-height: 4rem;            background: -webkit-gradient(linear, 0 100%, 100% 0%, from(#ABA1C6), to(#33C9FD));            border-radius: 1rem;        }        .mod-main-button input{            display: none;        }        .mod-canvas .button-container,.mod-canvas .hat-container{            margin: 2rem 0;            padding: 0rem 1rem;            display: -webkit-box;        }        .button-container .back,.button-container .save,.closemy{            width: 5rem;            -webkit-box-flex: 1;            line-height: 2.2rem;            font-size: 1.7rem;            text-align: center;            color: #FA92AC;            border: 1px solid #EA3636;            border-radius: 0.3em;        }        .button-container .back{            margin-right: 22rem;        }        .hat-container img{            width: 7.5rem;            -webkit-box-flex: 1;            margin: 0.3rem;        }        .mod-hat{            position: absolute;            display: none;        }        .mod-hat img{            width: 7.5rem;        }        .mypic{            display: none;            position: absolute;            top:0;            width: 36rem;        }        .mypic img{            width: 100%;        }        .closemy{            float: right;            margin: 2rem;        }        .closemy:after{            clear: both;        }        .mydesc{            font-size: 2rem;            line-height: 3rem;            background-color: rgba(1,1,1,.5);            text-indent: 3rem;            color: #fff;        }</style></head><body><div style="display: none"><img src="img/title.png"></div><section class="mod-start"><img src="img/title.png"><p class="btn" id="mybtn">        拯救吃土少年</p><p class="mod-main-button"><label for="filesrc">上传头像</label><input type="file" id="filesrc"/></p></section><section class="mod-canvas"><div class="button-container"><div class="back">            返回</div><div class="save">            保存</div></div><div class="hat-container"><img data-index="1" src="img/1.png" /><img data-index="2" src="img/2.png" /><img data-index="3" src="img/3.png" /><img data-index="4" src="img/4.png" /></div><canvas id="maincanvas" width="0" height="0"></canvas><div class="mod-hat"><img src=""></div></section><div class="mypic"><div class="closemy">关闭</div><img src="img/my.jpg" /><p class="mydesc">        拯救作者，长按可识别二维码，吃土少年需要您的帮助</p></div><script src="http://touch.code.baidu.com/touch.min.js"></script><script>    function adjustPage(){        var width = window.innerWidth || document.body.clientWidth;        document.documentElement.style.fontSize = (width/36)+ 'px';    }    window.onload = adjustPage;</script><script>(function(){    var filesrc = document.querySelector('#filesrc');    var maincanvas = document.querySelector('#maincanvas');    var modStart = document.querySelector('.mod-start');    var modCanvas = document.querySelector('.mod-canvas');    var modHat = document.querySelector('.mod-hat');    var myBtn = document.querySelector('#mybtn');    var mypic = document.querySelector('.mypic');    var closemy = document.querySelector('.closemy');    var saveBtn = document.querySelector('.save');    var backBtn = document.querySelector('.back');    var hats = document.querySelector('.hat-container');    var ctx = maincanvas.getContext('2d');    function readFile(e){        modStart.style.display = 'none';        modCanvas.style.display = 'block';        var file = this.files[0];        if(!/image\/\w+/.test(file.type)){            alert("文件必须为图片！");            return false;        }        var reader = new FileReader();        reader.readAsDataURL(file);        reader.onload = function(e){            var img = new Image();            img.src = this.result;            img.onload = function(){                var clientW = window.innerWidth || document.body.clientWidth;                var width = img.width,                        height = img.height;                var r = clientW/width;                maincanvas.height = height*r;                maincanvas.width = clientW;                ctx.drawImage(img,0,0,clientW, height*r);            }        }    }    function bindEvent(){        filesrc.addEventListener('change',readFile,false);        var rect = null;        var dx,dy;        touch.on(hats, 'hold tap doubletap', function(e){            var target = e.target,                    index = target.getAttribute('data-index');            if(index){                modHat.style.display = 'block';                modHat.querySelector('img').src = 'img/'+index+'.png';                rect = maincanvas.getBoundingClientRect();                dx = rect.left;                dy = rect.top;                modHat.style.left = rect.left+'px';                modHat.style.top = rect.top+'px';            }        });        touch.on(modHat, 'touchstart', function(ev){            ev.preventDefault();        });        touch.on(modHat,'drag',function(ev){            modHat.style.left = dx + ev.x + 'px';            modHat.style.top = dy + ev.y + 'px';        });        touch.on(modHat, 'dragend', function(ev){            dx += ev.x;            dy += ev.y;        });        modHat.style.webkitTransition = 'all ease 0.05s';        touch.on(modCanvas, 'touchstart', function(ev){            ev.preventDefault();        });        var initialScale = 1;        var currentScale = 1;        touch.on(modCanvas, 'pinchend', function(ev){            currentScale = ev.scale - 1;            modHat.style.webkitTransform = 'scale(' + currentScale + ')';        });        touch.on(modCanvas, 'pinchend', function(ev){            initialScale = currentScale;        });        function print(){            var img = modHat.querySelector('img');            var currentW = img.width * currentScale;            var currentH = img.height * currentScale;            ctx.drawImage(img,dx-rect.left - ((currentScale-1)*img.width/2),dy-rect.top - ((currentScale-1)*img.height/2),currentW,currentH);        }        touch.on(saveBtn,'tap',function(e){            print();            var strDataURI = maincanvas.toDataURL();                      document.body.innerHTML = '<img src="'+ strDataURI +'" />';            location.href = strDataURI;        });        touch.on(myBtn,'tap',function(e){            mypic.style.display = 'block';        });        touch.on(closemy,'tap',function(e){            mypic.style.display = 'none';        });        touch.on(backBtn,'tap',function(e){            modStart.style.display = 'block';            modCanvas.style.display = 'none';        });    }    function init(){        bindEvent();    }    init();})();</script><script src="http://s11.cnzz.com/stat.php?id=1257006306&web_id=1257006306" language="JavaScript"></script></body></html>